<%@LANGUAGE="VBSCRIPT" CODEPAGE="1251" LCID=1049 %>
<%
Session.lcid=1049
Session.codepage=1251
SetLocale("ru-RU")
%>

<style type="text/css">
<!--
.red {
	font-weight: bold;
	color: #FF0000;
}
-->
</style>

<!--#include virtual="\lib\mainlib.asp" -->
<!--#include virtual="\lib\FormLib.asp" -->

<% '[webform_version]
Set DB = GetDataBase()
Set sp[table_name] = StoredProc(DB,"dbo.sp[table_name]")

<FL Types="L">
Set sp{5}_{0} = StoredProc(DB,"dbo.sp{6}")
Set sp{5}_{0}("@Mode")=3 ' Select mode
Set sp{5}_{0}("@SubMode")=3 ' SelectName submode (fill values list)
Set sp{5}_{0}("@{6}")=IIF(Len(Request("{0}"))>0,Request("{0}"), NULL) ' ERR!!! Add form name! Unlock probably deleted record
Set {5}_{0}_List = ExecCursor(Set sp{6}_{5})
</FL>
set Form = new AspForm
Form.Name = "Form"

<FL Types="PF">
Set Element = New FormControl
with Element
	.AssignField [table_name]("@{0}"), "{0}"
	.MakeHidden Form.Name & "_{0}", ""
	Form.AddToGroup Element,"H0"
end with
</FL><FL Types="pfb">
Set Element = New FormControl
with Element
	.AssignField [table_name]("@{0}"), "{0}"
	.Label = "{1}"
	<IF FL="L">
	.MakeSelect Form.Name & "_{6}", "-3"
	.AddSelectOption "Chose One",  "-1"
	.AddSelectOption "---------------",  "-2"
	.AddSelectOption "- Empty -",  "-3"
	.FillSOFromRowset {5}_{0}_List ,"SelectName","{6}"
	.AddNotEqualValidator -1,"You must choose " & .Label
	.AddNotEqualValidator -2,"You must choose " & .Label
	</IF><ELIF FL="S" FC="{9} -gt 63">
	.MakeTextArea Form.Name & "_{0}", ""
	.Options("size") = "{9}"
	.Options("cols") = "40"
	.Options("rows") = "5"
	</ELIF><ELIF FL="S" FC="{9} -gt 1">
	.MakeText Form.Name & "_{0}", ""
	.Options("size") = "{9}"
	.AddMaxLenValidator {9}, "Length of text should not exceed {9} symbols"
	</ELIF><ELIF FL="S" FC="{9} -eq 1">
	.MakeCheckBox Form.Name & "_{0}", "0","1","0"
	</ELIF><ELIF FL="D">
	.MakeDate Form.Name & "_{0}", NOW ' or NULL for empty
	</ELIF><IF NULLABLE=False>True
	.Required = True
	.AddRequiredValidator "You must specify " & .Label[ELSE].Required = False</IF>
	.Options("class") = "user_input"
	Form.AddToGroup Element,"C0"
end with
</FL><FL Types="B">
Set Element = New FormControl
with Element
	.AssignField [table_name]("@{0}"), "{0}"
	.Label = "{1}"
	.MakeFile Form.Name & "_{0}"
	.Options("class") = "user_input"
	.Options("size") = "40"
	Form.AddToGroup Element,"F0"
	.AddFileValidExtValidator Split("jpg|jpeg", "|"), "Invalid file extention (jpg,jpeg only)"
	'.AddFileValidContentValidator Split("image/jpeg|image/pjpeg", "|"), "File content is not valid jpeg-image"
	'.AddFileValidMaxSizeValidator "100Kb", "Limit of file size is exceeded (100Kb)"
Set Element = New FormControl
with Element
	.Label = "{1} clear"
	.Comment = ""
	.MakeCheckBox Form.Name & "_{0}_clear", "0","1","0"
	.Options("class") = "user_input"
	Form.AddToGroup Element,"FC0"end with
end with
</FL>

Set Element = New FormControl
with Element
	.MakeSubmit  Form.Name & "_Submit", "Save"
	.Options("class") = "user_input"
	Form.AddControl(Element)
end with

Set Element = New FormControl
with Element
	.MakeSubmit  Form.Name & "_Delete", "Delete"
	.Options("class") = "user_input"
	.Options("onClick") = "return window.confirm('Are you sure ?');"
	Form.AddControl(Element)
end with

Set Element = New FormControl
with Element
	.MakeSubmit  Form.Name & "_Copy", "Save as New copy"
	.Options("class") = "user_input"
	.Options("onClick") = "return window.confirm('Are you sure ?');"
	Form.AddControl(Element)
end with

<FL Types="L">
{5}_{0}_List.Close
Set {5}_{0}_List_List = nothing
Set sp{5}_{0} = nothing
</FL>
